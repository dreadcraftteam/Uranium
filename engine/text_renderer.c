// Basic Text Rendering for Uranium Engine
// By DREADCRAFT, June 2025
//

#include "engine_variables.h"
#include "text_renderer.h"
#include <GL/gl.h>

static const unsigned char font_data[95][7] = 
{
    // A (0)
    { 0x0E, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11 },
    // B (1)
    { 0x1E, 0x11, 0x11, 0x1E, 0x11, 0x11, 0x1E },
    // C (2)
    { 0x0E, 0x11, 0x10, 0x10, 0x10, 0x11, 0x0E },
    // D (3)
    { 0x1E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x1E },
    // E (4)
    { 0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x1F },
    // F (5)
    { 0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x10 },
    // G (6)
    { 0x0E, 0x11, 0x10, 0x17, 0x11, 0x11, 0x0F },
    // H (7)
    { 0x11, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11 },
    // I (8)
    { 0x0E, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E },
    // J (9)
    { 0x07, 0x02, 0x02, 0x02, 0x02, 0x12, 0x0C },
    // K (10)
    { 0x11, 0x12, 0x14, 0x18, 0x14, 0x12, 0x11 },
    // L (11)
    { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1F },
    // M (12)
    { 0x11, 0x1B, 0x15, 0x11, 0x11, 0x11, 0x11 },
    // N (13)
    { 0x11, 0x19, 0x15, 0x13, 0x11, 0x11, 0x11 },
    // O (14)
    { 0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E },
    // P (15)
    { 0x1E, 0x11, 0x11, 0x1E, 0x10, 0x10, 0x10 },
    // Q (16)
    { 0x0E, 0x11, 0x11, 0x11, 0x15, 0x12, 0x0D },
    // R (17)
    { 0x1E, 0x11, 0x11, 0x1E, 0x14, 0x12, 0x11 },
    // S (18)
    { 0x0F, 0x10, 0x10, 0x0E, 0x01, 0x01, 0x1E },
    // T (19)
    { 0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04 },
    // U (20)
    { 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E },
    // V (21)
    { 0x11, 0x11, 0x11, 0x11, 0x0A, 0x0A, 0x04 },
    // W (22)
    { 0x11, 0x11, 0x11, 0x15, 0x15, 0x15, 0x0A },
    // X (23)
    { 0x11, 0x11, 0x0A, 0x04, 0x0A, 0x11, 0x11 },
    // Y (24)
    { 0x11, 0x11, 0x0A, 0x04, 0x04, 0x04, 0x04 },
    // Z (25)
    { 0x1F, 0x01, 0x02, 0x04, 0x08, 0x10, 0x1F },
    
    // 0
    { 0x0E, 0x11, 0x13, 0x15, 0x19, 0x11, 0x0E },
    // 1
    { 0x04, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x0E },
    // 2
    { 0x0E, 0x11, 0x01, 0x02, 0x04, 0x08, 0x1F },
    // 3
    { 0x1F, 0x02, 0x04, 0x02, 0x01, 0x11, 0x0E },
    // 4
    { 0x02, 0x06, 0x0A, 0x12, 0x1F, 0x02, 0x02 },
    // 5
    { 0x1F, 0x10, 0x1E, 0x01, 0x01, 0x11, 0x0E },
    // 6
    { 0x06, 0x08, 0x10, 0x1E, 0x11, 0x11, 0x0E },
    // 7
    { 0x1F, 0x01, 0x02, 0x04, 0x08, 0x08, 0x08 },
    // 8
    { 0x0E, 0x11, 0x11, 0x0E, 0x11, 0x11, 0x0E },
    // 9
    { 0x0E, 0x11, 0x11, 0x0F, 0x01, 0x02, 0x0C },
    
    // Space (36)
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
    // ! (37)
    { 0x04, 0x04, 0x04, 0x04, 0x00, 0x04, 0x00 },
    // ? (38)
    { 0x0E, 0x11, 0x01, 0x02, 0x04, 0x00, 0x04 },
    // . (39)
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04 },
    // , (40)
    { 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x08 },
    // : (41)
    { 0x00, 0x04, 0x00, 0x00, 0x04, 0x00, 0x00 },
    // ; (42)
    { 0x00, 0x04, 0x00, 0x00, 0x04, 0x04, 0x08 },
    // - (43)
    { 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00 },
    // + (44)
    { 0x00, 0x04, 0x04, 0x1F, 0x04, 0x04, 0x00 },
    // = (45)
    { 0x00, 0x00, 0x1F, 0x00, 0x1F, 0x00, 0x00 }
};

void initTextRendering() 
{
    glEnable(GL_BLEND);
    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
}

void renderText(const char* text, int x, int y, float scale, float color[3]) 
{
    glPushAttrib(GL_ENABLE_BIT | GL_CURRENT_BIT);
    glMatrixMode(GL_PROJECTION);
    glPushMatrix();
    glLoadIdentity();
    glOrtho(0, width, height, 0, -1, 1);
    
    glMatrixMode(GL_MODELVIEW);
    glPushMatrix();
    glLoadIdentity();
    
    glDisable(GL_DEPTH_TEST);
    glEnable(GL_BLEND);
    glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);
    
    glColor3fv(color);
    
    float startX = x;
    
    for (const char* p = text; *p; p++) {
        if (*p == '\n') {
            y += 8 * scale;
            x = startX;
            continue;
        }
        
        int char_index = -1;
        
        if (*p >= 'A' && *p <= 'Z') char_index = *p - 'A';
        else if (*p >= 'a' && *p <= 'z') char_index = *p - 'a';
        else if (*p >= '0' && *p <= '9') char_index = 26 + (*p - '0');
        else {
            switch(*p) {
                case ' ': char_index = 36; break;
                case '!': char_index = 37; break;
                case '?': char_index = 38; break;
                case '.': char_index = 39; break;
                case ',': char_index = 40; break;
                case ':': char_index = 41; break;
                case ';': char_index = 42; break;
                case '-': char_index = 43; break;
                case '+': char_index = 44; break;
                case '=': char_index = 45; break;
                default: continue;
            }
        }
        
        if (char_index < 0 || char_index >= sizeof(font_data)/sizeof(font_data[0])) {
            x += 6 * scale;
            continue;
        }
        
        const unsigned char* char_data = font_data[char_index];
        
        for (int row = 0; row < 7; row++) {
            for (int col = 0; col < 5; col++) {
                if (char_data[row] & (1 << (4 - col))) {
                    glBegin(GL_QUADS);
                        glVertex2f(x + col * scale,         y + row * scale);
                        glVertex2f(x + (col + 1) * scale,   y + row * scale);
                        glVertex2f(x + (col + 1) * scale,   y + (row + 1) * scale);
                        glVertex2f(x + col * scale,         y + (row + 1) * scale);
                    glEnd();
                }
            }
        }
        
        x += 6 * scale;
    }
    
    glPopMatrix();
    glMatrixMode(GL_PROJECTION);
    glPopMatrix();
    glMatrixMode(GL_MODELVIEW);
    glPopAttrib();
    
    glEnable(GL_DEPTH_TEST);
}